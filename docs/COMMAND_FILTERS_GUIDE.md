# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä—ã](#–∫–∞–∫-—Ä–∞–±–æ—Ç–∞—é—Ç-—Ñ–∏–ª—å—Ç—Ä—ã)
4. [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–Ω–æ–≤—ã—Ö-–∫–æ–º–∞–Ω–¥)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
6. [–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã](#–º–∏–≥—Ä–∞—Ü–∏—è-—Å–æ-—Å—Ç–∞—Ä–æ–π-—Å–∏—Å—Ç–µ–º—ã)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤** - "–∫–∞—Å—Ç–æ–º", "–∫–∞—Å—Ç–æ–º–∞", "–∫–∞—Å—Ç–æ–º—á–∏–∫" ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ **–°–ª–æ–≤–æ—Ñ–æ—Ä–º—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–∫–ª–æ–Ω–µ–Ω–∏–π
‚úÖ **–ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã** - "ad request" —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ
‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤** - –º–µ–Ω—é-–∫–æ–º–∞–Ω–¥—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
‚úÖ **–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - "–∑–∞–∫–∞–∑—ã" –±–µ–∑ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–∞ ‚Üí –º–µ–Ω—é, —Å —Ç–∏–ø–æ–º ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ
‚úÖ **Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - –≥–∏–±–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å –æ–ø–µ—á–∞—Ç–∫–∞–º–∏

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/router/
‚îú‚îÄ‚îÄ command_filters.py    # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ intent_v2.py          # –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ entities_v2.py        # –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ intent.py             # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
‚îî‚îÄ‚îÄ entities.py           # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. `CommandFilter` (dataclass)

–û–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä –∫–æ–º–∞–Ω–¥—ã:

```python
@dataclass
class CommandFilter:
    intent: CommandIntent              # –ö–∞–∫–æ–π –∏–Ω—Ç–µ–Ω—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è
    keywords: List[str]                # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    patterns: List[Pattern]            # Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    priority: int                      # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤—ã—à–µ = –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ)
    requires_number: bool              # –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ —á–∏—Å–ª–æ –≤ —Ç–µ–∫—Å—Ç–µ
    multi_word_phrases: List[str]      # –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
    exclude_with: List[str]            # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞-–∏—Å–∫–ª—é—á–µ–Ω–∏—è
```

#### 2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

```
100 - –ú–µ–Ω—é-–∫–æ–º–∞–Ω–¥—ã (—Å–≤–æ–¥–∫–∞, –∑–∞–∫–∞–∑—ã, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∞–∫–∫–∞—É–Ω—Ç)
 50 - –ö–æ–º–∞–Ω–¥—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)
 10 - –ö–æ–º–∞–Ω–¥—ã –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ä–µ–ø–æ—Ä—Ç—ã)
  0 - –ü–æ–∏—Å–∫ –º–æ–¥–µ–ª–∏ (fallback)
```

#### 3. –ë–∞–∑–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ `COMMAND_FILTERS`

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä—ã

### –ü—Ä–æ—Ü–µ—Å—Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
   ‚îî‚îÄ> lowercase, —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
   ‚îú‚îÄ> –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã (—Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å)
   ‚îú‚îÄ> –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
   ‚îî‚îÄ> Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã

3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏—è
   ‚îî‚îÄ> "–∑–∞–∫–∞–∑—ã" + "–∫–∞—Å—Ç–æ–º" ‚Üí CREATE_ORDERS, –Ω–µ SHOW_ORDERS

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
   ‚îî‚îÄ> –ï—Å–ª–∏ requires_number=True, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ

5. –í–æ–∑–≤—Ä–∞—Ç –ø–µ—Ä–≤–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
   ‚îî‚îÄ> –ò–ª–∏ SEARCH_MODEL / UNKNOWN
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**–í—Ö–æ–¥—è—â–∏–π —Ç–µ–∫—Å—Ç:** "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞"

```python
1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞"
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤:
   - SHOW_SUMMARY? ‚ùå –ù–µ—Ç "—Å–≤–æ–¥–∫–∞"
   - SHOW_ORDERS? ‚ùå –ù–µ—Ç "–∑–∞–∫–∞–∑—ã" –∏–ª–∏ –µ—Å—Ç—å exclude_with ("–∫–∞—Å—Ç–æ–º")
   - CREATE_ORDERS? ‚úÖ –ù–∞–π–¥–µ–Ω–æ "–∫–∞—Å—Ç–æ–º–∞" (keyword match)
3. –í–æ–∑–≤—Ä–∞—Ç: CommandIntent.CREATE_ORDERS
```

---

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å Intent

–í `command_filters.py`:

```python
class CommandIntent(Enum):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
    NEW_COMMAND = "new_command"  # –í–∞—à–∞ –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å CommandFilter

```python
COMMAND_FILTERS = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã

    CommandFilter(
        intent=CommandIntent.NEW_COMMAND,
        keywords=[
            # –†—É—Å—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            "–Ω–æ–≤–∞—è", "–Ω–æ–≤—É—é", "–Ω–æ–≤—ã–π",
            # –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            "new", "create-new",
        ],
        patterns=[
            # Regex –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
            re.compile(r'\b–Ω–æ–≤[–∞-—è]*\b', re.IGNORECASE),
            re.compile(r'\bnew\b', re.IGNORECASE),
        ],
        multi_word_phrases=[
            # –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
            "–Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞",
            "create new",
        ],
        priority=50,  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
        requires_number=False,  # –ù—É–∂–Ω–æ –ª–∏ —á–∏—Å–ª–æ?
        exclude_with=[],  # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞-–∏—Å–∫–ª—é—á–µ–Ω–∏—è
    ),
]
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å IGNORE_KEYWORDS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–æ–º–∞–Ω–¥—ã –ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–º–µ–Ω–∞–º–∏ –º–æ–¥–µ–ª–µ–π:

```python
IGNORE_KEYWORDS = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
    "–Ω–æ–≤–∞—è", "–Ω–æ–≤—É—é", "–Ω–æ–≤—ã–π", "new",
}
```

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å handler

–í `app/router/dispatcher.py`:

```python
async def route_message(...):
    # ...

    if intent == Intent.NEW_COMMAND:
        from app.handlers.new_command import handle_new_command
        await handle_new_command(message, entities, ...)
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.router.intent_v2 import classify_intent_v2
from app.router.entities_v2 import extract_entities_v2

# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
text = "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.CREATE_ORDERS

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
entities = extract_entities_v2(text)
# ‚Üí EntitiesV2(model='–º–µ–ª–∏—Å–∞', numbers=[3], order_type='custom')
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã

```python
text = "ad request —Å–æ—Ñ–∏ 2 —à—Ç—É–∫–∏"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.CREATE_ORDERS

entities = extract_entities_v2(text)
# ‚Üí EntitiesV2(model='—Å–æ—Ñ–∏', numbers=[2], order_type='ad request')
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```python
# –ë–µ–∑ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–∞ ‚Üí –º–µ–Ω—é
text = "–∑–∞–∫–∞–∑—ã"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.SHOW_ORDERS

# –° —Ç–∏–ø–æ–º –∑–∞–∫–∞–∑–∞ ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ
text = "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –∑–∞–∫–∞–∑—ã –º–µ–ª–∏—Å–∞"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.CREATE_ORDERS (—Ç.–∫. –µ—Å—Ç—å "–∫–∞—Å—Ç–æ–º–∞")
```

### –ü—Ä–∏–º–µ—Ä 4: –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–∞

```python
# –° —á–∏—Å–ª–æ–º ‚Üí ADD_FILES
text = "–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.ADD_FILES

# –ë–µ–∑ —á–∏—Å–ª–∞ ‚Üí –Ω–µ ADD_FILES
text = "–º–µ–ª–∏—Å–∞ —Ñ–∞–π–ª–æ–≤"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.SEARCH_MODEL (—Ç.–∫. –Ω–µ—Ç —á–∏—Å–ª–∞)
```

### –ü—Ä–∏–º–µ—Ä 5: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π

```python
from app.router.entities_v2 import extract_model_names

text = "–∫–∞—Å—Ç–æ–º –¥–ª—è –º–µ–ª–∏—Å–∞ —Å–æ—Ñ–∏ –∞–Ω–Ω–∞"
models = extract_model_names(text, max_count=3)
# ‚Üí ['–º–µ–ª–∏—Å–∞', '—Å–æ—Ñ–∏', '–∞–Ω–Ω–∞']
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ó–∞–º–µ–Ω–∞ –≤ –∫–æ–¥–µ

**–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:**
```python
from app.router.intent import classify_intent, Intent
from app.router.entities import extract_entities, Entities

intent = classify_intent(text)  # Intent enum
entities = extract_entities(text)  # Entities dataclass
```

**–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:**
```python
from app.router.intent_v2 import classify_intent_v2
from app.router.entities_v2 import extract_entities_v2
from app.router.command_filters import CommandIntent

intent = classify_intent_v2(text)  # CommandIntent enum
entities = extract_entities_v2(text)  # EntitiesV2 dataclass
```

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (`intent.py`, `entities.py`) —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

–ú–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å:

```python
# –í dispatcher.py
try:
    from app.router.intent_v2 import classify_intent_v2 as classify_intent
    from app.router.entities_v2 import extract_entities_v2 as extract_entities
    USE_V2 = True
except ImportError:
    from app.router.intent import classify_intent
    from app.router.entities import extract_entities
    USE_V2 = False
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã

–°–æ–∑–¥–∞—Ç—å `tests/test_command_filters.py`:

```python
import pytest
from app.router.intent_v2 import classify_intent_v2
from app.router.entities_v2 import extract_entities_v2
from app.router.command_filters import CommandIntent


class TestIntentClassification:
    """Test intent classification."""

    def test_create_orders_custom(self):
        """Test custom order creation."""
        assert classify_intent_v2("—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞") == CommandIntent.CREATE_ORDERS
        assert classify_intent_v2("–∫–∞—Å—Ç–æ–º –¥–ª—è –º–µ–ª–∏—Å—ã") == CommandIntent.CREATE_ORDERS
        assert classify_intent_v2("5 –∫–∞—Å—Ç–æ–º–æ–≤") == CommandIntent.CREATE_ORDERS

    def test_create_orders_ad_request(self):
        """Test ad request order creation."""
        assert classify_intent_v2("ad request —Å–æ—Ñ–∏") == CommandIntent.CREATE_ORDERS
        assert classify_intent_v2("–∞–¥ —Ä–µ–∫–≤–µ—Å—Ç –º–µ–ª–∏—Å–∞") == CommandIntent.CREATE_ORDERS

    def test_show_orders_menu(self):
        """Test showing orders menu."""
        assert classify_intent_v2("–∑–∞–∫–∞–∑—ã") == CommandIntent.SHOW_ORDERS
        assert classify_intent_v2("–ø–æ–∫–∞–∂–∏ –∑–∞–∫–∞–∑—ã") == CommandIntent.SHOW_ORDERS

    def test_show_orders_vs_create(self):
        """Test disambiguation between show orders and create orders."""
        # Without order type ‚Üí show menu
        assert classify_intent_v2("–∑–∞–∫–∞–∑—ã") == CommandIntent.SHOW_ORDERS
        # With order type ‚Üí create orders
        assert classify_intent_v2("—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –∑–∞–∫–∞–∑—ã") == CommandIntent.CREATE_ORDERS

    def test_add_files(self):
        """Test file addition."""
        assert classify_intent_v2("–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤") == CommandIntent.ADD_FILES
        assert classify_intent_v2("50 —Ñ–æ—Ç–æ —Å–æ—Ñ–∏") == CommandIntent.ADD_FILES

    def test_add_files_requires_number(self):
        """Test that file addition requires a number."""
        # With number ‚Üí ADD_FILES
        assert classify_intent_v2("–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤") == CommandIntent.ADD_FILES
        # Without number ‚Üí NOT ADD_FILES
        assert classify_intent_v2("–º–µ–ª–∏—Å–∞ —Ñ–∞–π–ª–æ–≤") != CommandIntent.ADD_FILES


class TestEntityExtraction:
    """Test entity extraction."""

    def test_extract_model_and_number(self):
        """Test extracting model name and number."""
        entities = extract_entities_v2("—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞")
        assert entities.model_name == "–º–µ–ª–∏—Å–∞"
        assert entities.numbers == [3]
        assert entities.order_type == "custom"

    def test_extract_order_type(self):
        """Test order type extraction."""
        assert extract_entities_v2("–∫–∞—Å—Ç–æ–º –º–µ–ª–∏—Å–∞").order_type == "custom"
        assert extract_entities_v2("—à–æ—Ä—Ç —Å–æ—Ñ–∏").order_type == "short"
        assert extract_entities_v2("–∫–æ–ª–ª –∞–Ω–Ω–∞").order_type == "call"
        assert extract_entities_v2("ad request –ª–∏–∑–∞").order_type == "ad request"

    def test_extract_multiple_numbers(self):
        """Test extracting multiple numbers."""
        entities = extract_entities_v2("3 –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞ 50 —Ñ–∞–π–ª–æ–≤")
        assert entities.numbers == [3, 50]
        assert entities.first_number == 3


if __name__ == "__main__":
    pytest.main([__file__, "-v"])
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest tests/test_command_filters.py -v
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –î–æ vs –ü–æ—Å–ª–µ

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ | –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
|--------|----------------|---------------|
| **–°–∏–Ω–æ–Ω–∏–º—ã** | ‚ùå –ñ–µ—Å—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ | ‚úÖ –ì–∏–±–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã |
| **–°–∫–ª–æ–Ω–µ–Ω–∏—è** | ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é | ‚úÖ Regex –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **–û–ø–µ—á–∞—Ç–∫–∏** | ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è | ‚úÖ Regex —Å –¥–æ–ø—É—Å–∫–æ–º |
| **–ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã** | ‚ùå –°–ª–æ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
| **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è** | ‚ùå –†–∞–∑–±—Ä–æ—Å–∞–Ω–æ –ø–æ —Ñ–∞–π–ª–∞–º | ‚úÖ –û–¥–∏–Ω —Ñ–∞–π–ª |
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** | ‚ùå –ñ–µ—Å—Ç–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤ –∫–æ–¥–µ | ‚úÖ –Ø–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Å–æ–≤ |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | ‚ùå –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã | ‚úÖ –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å CommandFilter |

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ
- –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏
- O(n) –≥–¥–µ n = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–æ–±—ã—á–Ω–æ < 10)

---

## FAQ

**Q: –ù—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã?**
A: –ù–µ—Ç, –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–ø–µ—á–∞—Ç–æ–∫?**
A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å regex —Å optional —Å–∏–º–≤–æ–ª–∞–º–∏: `r'\b–∫–∞?—Å—Ç–æ?–º[–∞-—è]*\b'` –ª–æ–≤–∏—Ç "–∫–∞—Å–æ–º", "–∫–∞—Å—Ç–º", –∏ —Ç.–¥.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã?**
A: –î–∞, `COMMAND_FILTERS.append(CommandFilter(...))` –≤–æ –≤—Ä–µ–º—è runtime.

**Q: –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏?**
A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `exclude_with` –¥–ª—è –ø—Ä–∞–≤–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≤—ã—Å–∏—Ç—å `priority` –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤.

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º:
- –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-02-03
