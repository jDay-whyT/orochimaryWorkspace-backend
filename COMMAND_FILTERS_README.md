# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ —É–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –¥–ª—è Telegram-–±–æ—Ç–∞ —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –±–∞–∑–æ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∏–Ω–æ–Ω–∏–º–æ–≤, —Å–ª–æ–≤–æ—Ñ–æ—Ä–º –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
app/router/
‚îú‚îÄ‚îÄ command_filters.py       # ‚≠ê –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ intent_v2.py             # ‚≠ê –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ entities_v2.py           # ‚≠ê –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π

docs/
‚îî‚îÄ‚îÄ COMMAND_FILTERS_GUIDE.md # üìñ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

examples/
‚îî‚îÄ‚îÄ command_filter_examples.py # üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

tests/
‚îî‚îÄ‚îÄ test_command_filters.py  # ‚úÖ Unit-—Ç–µ—Å—Ç—ã
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

```
app/router/
‚îú‚îÄ‚îÄ intent.py                # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
‚îú‚îÄ‚îÄ entities.py              # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
‚îî‚îÄ‚îÄ patterns.py              # Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã (—á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.router.intent_v2 import classify_intent_v2
from app.router.entities_v2 import extract_entities_v2
from app.router.command_filters import CommandIntent

# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–∞
text = "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞"
intent = classify_intent_v2(text)
# ‚Üí CommandIntent.CREATE_ORDERS

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
entities = extract_entities_v2(text)
# ‚Üí EntitiesV2(model='–º–µ–ª–∏—Å–∞', numbers=[3], order_type='custom')

print(f"–ú–æ–¥–µ–ª—å: {entities.model_name}")       # –º–µ–ª–∏—Å–∞
print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {entities.first_number}") # 3
print(f"–¢–∏–ø: {entities.order_type}")          # custom
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤

```bash
python examples/command_filter_examples.py
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest tests/test_command_filters.py -v
```

---

## üé® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (`command_filters.py`):

```python
CommandFilter(
    intent=CommandIntent.CREATE_ORDERS,
    keywords=["–∫–∞—Å—Ç–æ–º", "–∫–∞—Å—Ç–æ–º–∞", "–∫–∞—Å—Ç–æ–º–æ–≤", "custom"],
    patterns=[re.compile(r'\b–∫–∞—Å—Ç–æ–º[–∞-—è]*\b', re.IGNORECASE)],
    priority=50,
)
```

### ‚úÖ 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∏ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –≤–∞—Ä–∏–∞—Ü–∏–∏:

- "–∫–∞—Å—Ç–æ–º", "–∫–∞—Å—Ç–æ–º–∞", "–∫–∞—Å—Ç–æ–º–æ–≤", "–∫–∞—Å—Ç–æ–º—á–∏–∫" ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- "—à–æ—Ä—Ç", "—à–æ—Ä—Ç–∞", "—à–æ—Ä—Ç–æ–≤" ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- "—Ñ–∞–π–ª", "—Ñ–∞–π–ª–∞", "—Ñ–∞–π–ª–æ–≤", "—Ñ–∞–π–ª–∏–∫" ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚úÖ 3. –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã

"ad request" —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ:

```python
text = "ad request —Å–æ—Ñ–∏ 2 —à—Ç—É–∫–∏"
entities = extract_entities_v2(text)
# ‚Üí order_type="ad request", model="—Å–æ—Ñ–∏"
```

### ‚úÖ 4. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

```
100 - –ú–µ–Ω—é-–∫–æ–º–∞–Ω–¥—ã (—Å–≤–æ–¥–∫–∞, –∑–∞–∫–∞–∑—ã, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
 50 - –ö–æ–º–∞–Ω–¥—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤, —Ñ–∞–π–ª—ã)
 10 - –ö–æ–º–∞–Ω–¥—ã –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ä–µ–ø–æ—Ä—Ç—ã)
  0 - –ü–æ–∏—Å–∫ –º–æ–¥–µ–ª–∏
```

### ‚úÖ 5. –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

–£–º–Ω–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥:

```python
classify_intent_v2("–∑–∞–∫–∞–∑—ã")              # ‚Üí SHOW_ORDERS
classify_intent_v2("—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –∑–∞–∫–∞–∑—ã")  # ‚Üí CREATE_ORDERS (–µ—Å—Ç—å —Ç–∏–ø –∑–∞–∫–∞–∑–∞)
```

### ‚úÖ 6. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

```python
classify_intent_v2("–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤")  # ‚Üí ADD_FILES (–µ—Å—Ç—å —á–∏—Å–ª–æ)
classify_intent_v2("–º–µ–ª–∏—Å–∞ —Ñ–∞–π–ª–æ–≤")     # ‚Üí SEARCH_MODEL (–Ω–µ—Ç —á–∏—Å–ª–∞)
```

---

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

| Intent | –ü—Ä–∏–º–µ—Ä—ã | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|--------|---------|-----------|
| **SHOW_SUMMARY** | "—Å–≤–æ–¥–∫–∞", "–ø–æ–∫–∞–∂–∏ —Å–≤–æ–¥–∫—É" | 100 |
| **SHOW_ORDERS** | "–∑–∞–∫–∞–∑—ã" (–±–µ–∑ —Ç–∏–ø–∞) | 100 |
| **SHOW_PLANNER** | "–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫", "–ø–ª–∞–Ω" | 100 |
| **SHOW_ACCOUNT** | "–∞–∫–∫–∞—É–Ω—Ç", "–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è" | 100 |
| **CREATE_ORDERS** | "—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞" | 50 |
| **ADD_FILES** | "–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤" | 50 |
| **GET_REPORT** | "—Ä–µ–ø–æ—Ä—Ç –º–µ–ª–∏—Å–∞" | 10 |
| **SEARCH_MODEL** | "–º–µ–ª–∏—Å–∞" (1-2 —Å–ª–æ–≤–∞) | 0 |

---

## üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å Intent

```python
class CommandIntent(Enum):
    NEW_COMMAND = "new_command"
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å CommandFilter

```python
COMMAND_FILTERS.append(
    CommandFilter(
        intent=CommandIntent.NEW_COMMAND,
        keywords=["–Ω–æ–≤–∞—è", "new"],
        patterns=[re.compile(r'\b–Ω–æ–≤[–∞-—è]*\b', re.IGNORECASE)],
        priority=50,
    )
)
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å handler

```python
if intent == CommandIntent.NEW_COMMAND:
    await handle_new_command(message, entities)
```

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [`docs/COMMAND_FILTERS_GUIDE.md`](docs/COMMAND_FILTERS_GUIDE.md)

–í–∫–ª—é—á–∞–µ—Ç:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤: [`tests/test_command_filters.py`](tests/test_command_filters.py)

–ü–æ–∫—Ä—ã—Ç–∏–µ:
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚úÖ –í–∞—Ä–∏–∞—Ü–∏–∏ —Å–ª–æ–≤
- ‚úÖ –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω –º–æ–¥–µ–ª–µ–π

–ó–∞–ø—É—Å–∫:
```bash
pytest tests/test_command_filters.py -v
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

```python
# –í—Å–µ —ç—Ç–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
"–∫–∞—Å—Ç–æ–º –º–µ–ª–∏—Å–∞"           ‚Üí CREATE_ORDERS
"—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –º–µ–ª–∏—Å–∞"      ‚Üí CREATE_ORDERS
"5 –∫–∞—Å—Ç–æ–º–æ–≤ –¥–ª—è —Å–æ—Ñ–∏"     ‚Üí CREATE_ORDERS
"–∫–∞—Å—Ç–æ–º—á–∏–∫"               ‚Üí CREATE_ORDERS
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```python
"–º–µ–ª–∏—Å–∞ 30 —Ñ–∞–π–ª–æ–≤"        ‚Üí ADD_FILES
"50 —Ñ–æ—Ç–æ —Å–æ—Ñ–∏"            ‚Üí ADD_FILES
"–¥–æ–±–∞–≤—å 100 —Ñ–∞–π–ª–æ–≤"       ‚Üí ADD_FILES
"–º–µ–ª–∏—Å–∞ —Ñ–∞–π–ª–æ–≤"           ‚Üí NOT ADD_FILES (–Ω–µ—Ç —á–∏—Å–ª–∞)
```

### –ü—Ä–∏–º–µ—Ä 3: Ad Request

```python
"ad request —Å–æ—Ñ–∏"         ‚Üí CREATE_ORDERS (order_type="ad request")
"–∞–¥ —Ä–µ–∫–≤–µ—Å—Ç –º–µ–ª–∏—Å–∞"       ‚Üí CREATE_ORDERS (order_type="ad request")
```

### –ü—Ä–∏–º–µ—Ä 4: –ú–µ–Ω—é vs –î–µ–π—Å—Ç–≤–∏—è

```python
"–∑–∞–∫–∞–∑—ã"                  ‚Üí SHOW_ORDERS (–º–µ–Ω—é)
"—Ç—Ä–∏ –∫–∞—Å—Ç–æ–º–∞ –∑–∞–∫–∞–∑—ã"      ‚Üí CREATE_ORDERS (–¥–µ–π—Å—Ç–≤–∏–µ)
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

### –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ –∏–º–ø–æ—Ä—Ç–æ–≤

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥
from app.router.intent import classify_intent, Intent
from app.router.entities import extract_entities

# –ù–æ–≤—ã–π –∫–æ–¥
from app.router.intent_v2 import classify_intent_v2 as classify_intent
from app.router.entities_v2 import extract_entities_v2 as extract_entities
from app.router.command_filters import CommandIntent as Intent
```

### –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –º–æ–¥—É–ª—å –∑–∞ –º–æ–¥—É–ª–µ–º.

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ê—Å–ø–µ–∫—Ç | –î–æ | –ü–æ—Å–ª–µ |
|--------|-----|-------|
| **–°–∏–Ω–æ–Ω–∏–º—ã** | ‚ùå –ñ–µ—Å—Ç–∫–∏–µ —Å–ø–∏—Å–∫–∏ | ‚úÖ –ì–∏–±–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã |
| **–°–∫–ª–æ–Ω–µ–Ω–∏—è** | ‚ùå –í—Ä—É—á–Ω—É—é | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **–ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ** | ‚ùå –°–ª–æ–∂–Ω–æ | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–æ |
| **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è** | ‚ùå –†–∞–∑–±—Ä–æ—Å–∞–Ω–æ | ‚úÖ –û–¥–∏–Ω —Ñ–∞–π–ª |
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** | ‚ùå –ù–µ—è–≤–Ω—ã–µ | ‚úÖ –Ø–≤–Ω—ã–µ –≤–µ—Å–∞ |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | ‚ùå –°–ª–æ–∂–Ω–æ | ‚úÖ –ü—Ä–æ—Å—Ç–æ |

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
- –ß–∏—Ç–∞–π—Ç–µ –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: `docs/COMMAND_FILTERS_GUIDE.md`
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã: `python examples/command_filter_examples.py`
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2026-02-03
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
